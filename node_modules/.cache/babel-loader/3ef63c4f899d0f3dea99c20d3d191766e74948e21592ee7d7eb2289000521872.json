{"ast":null,"code":"var _jsxFileName = \"c:\\\\apps\\\\src\\\\components\\\\LayoutCanvas.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useMemo, useState } from 'react';\nimport * as turf from '@turf/turf';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LayoutCanvas({\n  zoneW,\n  zoneH,\n  polygonPoints,\n  closed,\n  placements,\n  setPlacements,\n  removeTile,\n  margin\n}) {\n  _s();\n  const canvasRef = useRef();\n  const [dragging, setDragging] = useState(null);\n  const scale = 100; // px per meter\n  const snapTol = 0.05; // meters\n\n  // Inward buffer for containment\n  const innerPoly = useMemo(() => {\n    if (!closed || polygonPoints.length < 3) return null;\n    const coords = polygonPoints.map(p => [p.x, p.y]);\n    coords.push(coords[0]);\n    return turf.buffer(turf.polygon([coords]), -margin, {\n      units: 'meters',\n      steps: 64\n    });\n  }, [polygonPoints, closed, margin]);\n\n  // Containment test\n  function fitsInside(x, y, w, h) {\n    if (!innerPoly) return false;\n    const rect = turf.polygon([[[x, y], [x + w, y], [x + w, y + h], [x, y + h], [x, y]]]);\n    return turf.booleanContains(innerPoly, rect);\n  }\n\n  // Snap to neighbor edges\n  function applySnap(idx, x, y, w, h) {\n    placements.forEach((t, j) => {\n      if (j === idx) return;\n      [[t.x], [t.x + t.width]].forEach(([sx]) => {\n        if (Math.abs(x - sx) < snapTol) x = sx;\n        if (Math.abs(x + w - sx) < snapTol) x = sx - w;\n      });\n      [[t.y], [t.y + t.height]].forEach(([sy]) => {\n        if (Math.abs(y - sy) < snapTol) y = sy;\n        if (Math.abs(y + h - sy) < snapTol) y = sy - h;\n      });\n    });\n    return {\n      x,\n      y\n    };\n  }\n\n  // Drag & double‑click delete\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    function toTile(e) {\n      const r = canvas.getBoundingClientRect();\n      return {\n        mx: (e.clientX - r.left) / scale,\n        my: (e.clientY - r.top) / scale\n      };\n    }\n    function down(e) {\n      const {\n        mx,\n        my\n      } = toTile(e);\n      for (let i = placements.length - 1; i >= 0; i--) {\n        const t = placements[i];\n        if (mx >= t.x && mx <= t.x + t.width && my >= t.y && my <= t.y + t.height) {\n          if (e.detail === 2) {\n            removeTile(i);\n            return;\n          }\n          setDragging({\n            idx: i,\n            offsetX: mx - t.x,\n            offsetY: my - t.y\n          });\n          return;\n        }\n      }\n    }\n    function move(e) {\n      if (!dragging) return;\n      const {\n        mx,\n        my\n      } = toTile(e);\n      const {\n        idx,\n        offsetX,\n        offsetY\n      } = dragging;\n      const t = placements[idx];\n      let nx = mx - offsetX,\n        ny = my - offsetY;\n      ({\n        x: nx,\n        y: ny\n      } = applySnap(idx, nx, ny, t.width, t.height));\n      if (fitsInside(nx, ny, t.width, t.height)) {\n        const np = [...placements];\n        np[idx] = {\n          ...t,\n          x: nx,\n          y: ny\n        };\n        setPlacements(np);\n      }\n    }\n    function up() {\n      if (dragging) setDragging(null);\n    }\n    canvas.addEventListener('mousedown', down);\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n    return () => {\n      canvas.removeEventListener('mousedown', down);\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n  }, [dragging, placements, innerPoly]);\n\n  // Draw everything\n  useEffect(() => {\n    const c = canvasRef.current,\n      ctx = c.getContext('2d');\n    c.width = zoneW * scale;\n    c.height = zoneH * scale;\n    ctx.clearRect(0, 0, c.width, c.height);\n\n    // Polygon\n    if (polygonPoints.length) {\n      ctx.strokeStyle = '#0066CC';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      polygonPoints.forEach((p, i) => {\n        const X = p.x * scale,\n          Y = p.y * scale;\n        i === 0 ? ctx.moveTo(X, Y) : ctx.lineTo(X, Y);\n      });\n      if (closed) ctx.closePath();\n      ctx.stroke();\n      ctx.fillStyle = '#0066CC';\n      polygonPoints.forEach(p => {\n        ctx.beginPath();\n        ctx.arc(p.x * scale, p.y * scale, 4, 0, 2 * Math.PI);\n        ctx.fill();\n      });\n    }\n\n    // Tiles\n    placements.forEach(t => {\n      const x = t.x * scale,\n        y = t.y * scale;\n      const w = t.width * scale,\n        h = t.height * scale;\n      ctx.fillStyle = '#DDD';\n      ctx.strokeStyle = '#333';\n      ctx.lineWidth = 1;\n      ctx.fillRect(x, y, w, h);\n      ctx.strokeRect(x, y, w, h);\n    });\n    if (!closed || placements.length === 0) return;\n\n    // Red: union→micro‑clean→outward buffer→clip→draw\n    let unionPoly = null;\n    placements.forEach(t => {\n      const poly = turf.polygon([[[t.x, t.y], [t.x + t.width, t.y], [t.x + t.width, t.y + t.height], [t.x, t.y + t.height], [t.x, t.y]]]);\n      unionPoly = unionPoly ? turf.union(unionPoly, poly) : poly;\n    });\n    unionPoly = turf.buffer(unionPoly, 0.000001, {\n      units: 'meters'\n    });\n    unionPoly = turf.buffer(unionPoly, -0.000001, {\n      units: 'meters'\n    });\n    let redBuf = turf.buffer(unionPoly, margin, {\n      units: 'meters',\n      steps: 64\n    });\n    // clip by inward‑buffered polygon\n    const room = turf.polygon([[...polygonPoints.map(p => [p.x, p.y]), [polygonPoints[0].x, polygonPoints[0].y]]]);\n    const innerClip = turf.buffer(room, -margin, {\n      units: 'meters',\n      steps: 64\n    });\n    const clipped = turf.intersect(redBuf, innerClip);\n    if (clipped) redBuf = clipped;\n    const geom = redBuf.geometry;\n    const rings = geom.type === 'Polygon' ? [geom.coordinates[0]] : geom.coordinates.map(c => c[0]);\n    ctx.strokeStyle = 'red';\n    ctx.setLineDash([6, 4]);\n    ctx.lineWidth = 2;\n    rings.forEach(ring => {\n      ctx.beginPath();\n      ring.forEach(([px, py], i) => {\n        const X = px * scale,\n          Y = py * scale;\n        i === 0 ? ctx.moveTo(X, Y) : ctx.lineTo(X, Y);\n      });\n      ctx.stroke();\n    });\n    ctx.setLineDash([]);\n\n    // Green: inward offset of polygon edges\n    ctx.strokeStyle = 'green';\n    ctx.setLineDash([4, 2]);\n    ctx.lineWidth = 2;\n    let area2 = 0;\n    polygonPoints.forEach((p, i) => {\n      const q = polygonPoints[(i + 1) % polygonPoints.length];\n      area2 += p.x * q.y - q.x * p.y;\n    });\n    const ccw = area2 > 0;\n    polygonPoints.forEach((p, i) => {\n      const q = polygonPoints[(i + 1) % polygonPoints.length];\n      const dx = q.x - p.x,\n        dy = q.y - p.y,\n        len = Math.hypot(dx, dy);\n      const nx = ccw ? -dy / len : dy / len;\n      const ny = ccw ? dx / len : -dx / len;\n      const px = (p.x + nx * margin) * scale;\n      const py = (p.y + ny * margin) * scale;\n      const qx = (q.x + nx * margin) * scale;\n      const qy = (q.y + ny * margin) * scale;\n      ctx.beginPath();\n      ctx.moveTo(px, py);\n      ctx.lineTo(qx, qy);\n      ctx.stroke();\n    });\n    ctx.setLineDash([]);\n  }, [zoneW, zoneH, polygonPoints, closed, placements, margin]);\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      border: '1px solid #333',\n      cursor: dragging ? 'grabbing' : 'grab',\n      marginTop: 20\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 199,\n    columnNumber: 5\n  }, this);\n}\n_s(LayoutCanvas, \"kiaGtzYXKhKNH9EKMth3WvM/eXA=\");\n_c = LayoutCanvas;\nvar _c;\n$RefreshReg$(_c, \"LayoutCanvas\");","map":{"version":3,"names":["React","useRef","useEffect","useMemo","useState","turf","jsxDEV","_jsxDEV","LayoutCanvas","zoneW","zoneH","polygonPoints","closed","placements","setPlacements","removeTile","margin","_s","canvasRef","dragging","setDragging","scale","snapTol","innerPoly","length","coords","map","p","x","y","push","buffer","polygon","units","steps","fitsInside","w","h","rect","booleanContains","applySnap","idx","forEach","t","j","width","sx","Math","abs","height","sy","canvas","current","toTile","e","r","getBoundingClientRect","mx","clientX","left","my","clientY","top","down","i","detail","offsetX","offsetY","move","nx","ny","np","up","addEventListener","window","removeEventListener","c","ctx","getContext","clearRect","strokeStyle","lineWidth","beginPath","X","Y","moveTo","lineTo","closePath","stroke","fillStyle","arc","PI","fill","fillRect","strokeRect","unionPoly","poly","union","redBuf","room","innerClip","clipped","intersect","geom","geometry","rings","type","coordinates","setLineDash","ring","px","py","area2","q","ccw","dx","dy","len","hypot","qx","qy","ref","style","border","cursor","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["c:/apps/src/components/LayoutCanvas.js"],"sourcesContent":["import React, { useRef, useEffect, useMemo, useState } from 'react';\r\nimport * as turf from '@turf/turf';\r\n\r\nexport default function LayoutCanvas({\r\n  zoneW,\r\n  zoneH,\r\n  polygonPoints,\r\n  closed,\r\n  placements,\r\n  setPlacements,\r\n  removeTile,\r\n  margin\r\n}) {\r\n  const canvasRef = useRef();\r\n  const [dragging, setDragging] = useState(null);\r\n  const scale = 100;    // px per meter\r\n  const snapTol = 0.05; // meters\r\n\r\n  // Inward buffer for containment\r\n  const innerPoly = useMemo(() => {\r\n    if (!closed || polygonPoints.length < 3) return null;\r\n    const coords = polygonPoints.map(p=>[p.x,p.y]);\r\n    coords.push(coords[0]);\r\n    return turf.buffer(turf.polygon([coords]), -margin, { units:'meters', steps:64 });\r\n  }, [polygonPoints, closed, margin]);\r\n\r\n  // Containment test\r\n  function fitsInside(x,y,w,h) {\r\n    if (!innerPoly) return false;\r\n    const rect = turf.polygon([[\r\n      [x,y],[x+w,y],[x+w,y+h],[x,y+h],[x,y]\r\n    ]]);\r\n    return turf.booleanContains(innerPoly, rect);\r\n  }\r\n\r\n  // Snap to neighbor edges\r\n  function applySnap(idx,x,y,w,h) {\r\n    placements.forEach((t,j)=>{\r\n      if (j===idx) return;\r\n      [[t.x],[t.x+t.width]].forEach(([sx])=>{\r\n        if (Math.abs(x-sx)<snapTol) x=sx;\r\n        if (Math.abs(x+w-sx)<snapTol) x=sx-w;\r\n      });\r\n      [[t.y],[t.y+t.height]].forEach(([sy])=>{\r\n        if (Math.abs(y-sy)<snapTol) y=sy;\r\n        if (Math.abs(y+h-sy)<snapTol) y=sy-h;\r\n      });\r\n    });\r\n    return { x,y };\r\n  }\r\n\r\n  // Drag & double‑click delete\r\n  useEffect(()=>{\r\n    const canvas = canvasRef.current;\r\n    function toTile(e) {\r\n      const r=canvas.getBoundingClientRect();\r\n      return {\r\n        mx:(e.clientX-r.left)/scale,\r\n        my:(e.clientY-r.top)/scale\r\n      };\r\n    }\r\n    function down(e) {\r\n      const {mx,my}=toTile(e);\r\n      for(let i=placements.length-1;i>=0;i--){\r\n        const t=placements[i];\r\n        if(mx>=t.x&&mx<=t.x+t.width&&my>=t.y&&my<=t.y+t.height){\r\n          if(e.detail===2){ removeTile(i); return; }\r\n          setDragging({ idx:i, offsetX:mx-t.x, offsetY:my-t.y });\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    function move(e) {\r\n      if(!dragging) return;\r\n      const {mx,my}=toTile(e);\r\n      const {idx,offsetX,offsetY}=dragging;\r\n      const t=placements[idx];\r\n      let nx=mx-offsetX, ny=my-offsetY;\r\n      ({x:nx,y:ny}=applySnap(idx,nx,ny,t.width,t.height));\r\n      if(fitsInside(nx,ny,t.width,t.height)){\r\n        const np=[...placements];\r\n        np[idx]={...t,x:nx,y:ny};\r\n        setPlacements(np);\r\n      }\r\n    }\r\n    function up(){ if(dragging) setDragging(null); }\r\n    canvas.addEventListener('mousedown',down);\r\n    window.addEventListener('mousemove',move);\r\n    window.addEventListener('mouseup',up);\r\n    return ()=>{\r\n      canvas.removeEventListener('mousedown',down);\r\n      window.removeEventListener('mousemove',move);\r\n      window.removeEventListener('mouseup',up);\r\n    };\r\n  },[dragging,placements,innerPoly]);\r\n\r\n  // Draw everything\r\n  useEffect(()=>{\r\n    const c=canvasRef.current, ctx=c.getContext('2d');\r\n    c.width=zoneW*scale; c.height=zoneH*scale;\r\n    ctx.clearRect(0,0,c.width,c.height);\r\n\r\n    // Polygon\r\n    if(polygonPoints.length){\r\n      ctx.strokeStyle='#0066CC'; ctx.lineWidth=2;\r\n      ctx.beginPath();\r\n      polygonPoints.forEach((p,i)=>{\r\n        const X=p.x*scale, Y=p.y*scale;\r\n        i===0?ctx.moveTo(X,Y):ctx.lineTo(X,Y);\r\n      });\r\n      if(closed)ctx.closePath();\r\n      ctx.stroke();\r\n      ctx.fillStyle='#0066CC';\r\n      polygonPoints.forEach(p=>{\r\n        ctx.beginPath();\r\n        ctx.arc(p.x*scale,p.y*scale,4,0,2*Math.PI);\r\n        ctx.fill();\r\n      });\r\n    }\r\n\r\n    // Tiles\r\n    placements.forEach(t=>{\r\n      const x=t.x*scale,y=t.y*scale;\r\n      const w=t.width*scale,h=t.height*scale;\r\n      ctx.fillStyle='#DDD';\r\n      ctx.strokeStyle='#333';\r\n      ctx.lineWidth=1;\r\n      ctx.fillRect(x,y,w,h);\r\n      ctx.strokeRect(x,y,w,h);\r\n    });\r\n\r\n    if(!closed||placements.length===0) return;\r\n\r\n    // Red: union→micro‑clean→outward buffer→clip→draw\r\n    let unionPoly=null;\r\n    placements.forEach(t=>{\r\n      const poly=turf.polygon([[\r\n        [t.x,t.y],\r\n        [t.x+t.width,t.y],\r\n        [t.x+t.width,t.y+t.height],\r\n        [t.x,t.y+t.height],\r\n        [t.x,t.y]\r\n      ]]);\r\n      unionPoly=unionPoly?turf.union(unionPoly,poly):poly;\r\n    });\r\n    unionPoly = turf.buffer(unionPoly,0.000001,{units:'meters'});\r\n    unionPoly = turf.buffer(unionPoly,-0.000001,{units:'meters'});\r\n    let redBuf = turf.buffer(unionPoly,margin,{units:'meters',steps:64});\r\n    // clip by inward‑buffered polygon\r\n    const room = turf.polygon([[\r\n      ...polygonPoints.map(p=>[p.x,p.y]),\r\n      [polygonPoints[0].x,polygonPoints[0].y]\r\n    ]]);\r\n    const innerClip = turf.buffer(room,-margin,{units:'meters',steps:64});\r\n    const clipped = turf.intersect(redBuf,innerClip);\r\n    if(clipped) redBuf = clipped;\r\n    const geom = redBuf.geometry;\r\n    const rings = geom.type==='Polygon'\r\n      ? [geom.coordinates[0]]\r\n      : geom.coordinates.map(c=>c[0]);\r\n    ctx.strokeStyle='red'; ctx.setLineDash([6,4]); ctx.lineWidth=2;\r\n    rings.forEach(ring=>{\r\n      ctx.beginPath();\r\n      ring.forEach(([px,py],i)=>{\r\n        const X=px*scale, Y=py*scale;\r\n        i===0?ctx.moveTo(X,Y):ctx.lineTo(X,Y);\r\n      });\r\n      ctx.stroke();\r\n    });\r\n    ctx.setLineDash([]);\r\n\r\n    // Green: inward offset of polygon edges\r\n    ctx.strokeStyle='green'; ctx.setLineDash([4,2]); ctx.lineWidth=2;\r\n    let area2=0;\r\n    polygonPoints.forEach((p,i)=>{\r\n      const q=polygonPoints[(i+1)%polygonPoints.length];\r\n      area2 += p.x*q.y - q.x*p.y;\r\n    });\r\n    const ccw = area2 > 0;\r\n    polygonPoints.forEach((p,i)=>{\r\n      const q = polygonPoints[(i+1)%polygonPoints.length];\r\n      const dx = q.x-p.x, dy = q.y-p.y, len = Math.hypot(dx,dy);\r\n      const nx = ccw ? -dy/len : dy/len;\r\n      const ny = ccw ?  dx/len : -dx/len;\r\n      const px = (p.x + nx*margin)*scale;\r\n      const py = (p.y + ny*margin)*scale;\r\n      const qx = (q.x + nx*margin)*scale;\r\n      const qy = (q.y + ny*margin)*scale;\r\n      ctx.beginPath();\r\n      ctx.moveTo(px,py);\r\n      ctx.lineTo(qx,qy);\r\n      ctx.stroke();\r\n    });\r\n    ctx.setLineDash([]);\r\n\r\n  },[zoneW,zoneH,polygonPoints,closed,placements,margin]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={canvasRef}\r\n      style={{\r\n        border:'1px solid #333',\r\n        cursor:dragging?'grabbing':'grab',\r\n        marginTop:20\r\n      }}\r\n    />\r\n  );\r\n}\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACnE,OAAO,KAAKC,IAAI,MAAM,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEnC,eAAe,SAASC,YAAYA,CAAC;EACnCC,KAAK;EACLC,KAAK;EACLC,aAAa;EACbC,MAAM;EACNC,UAAU;EACVC,aAAa;EACbC,UAAU;EACVC;AACF,CAAC,EAAE;EAAAC,EAAA;EACD,MAAMC,SAAS,GAAGjB,MAAM,CAAC,CAAC;EAC1B,MAAM,CAACkB,QAAQ,EAAEC,WAAW,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAC9C,MAAMiB,KAAK,GAAG,GAAG,CAAC,CAAI;EACtB,MAAMC,OAAO,GAAG,IAAI,CAAC,CAAC;;EAEtB;EACA,MAAMC,SAAS,GAAGpB,OAAO,CAAC,MAAM;IAC9B,IAAI,CAACS,MAAM,IAAID,aAAa,CAACa,MAAM,GAAG,CAAC,EAAE,OAAO,IAAI;IACpD,MAAMC,MAAM,GAAGd,aAAa,CAACe,GAAG,CAACC,CAAC,IAAE,CAACA,CAAC,CAACC,CAAC,EAACD,CAAC,CAACE,CAAC,CAAC,CAAC;IAC9CJ,MAAM,CAACK,IAAI,CAACL,MAAM,CAAC,CAAC,CAAC,CAAC;IACtB,OAAOpB,IAAI,CAAC0B,MAAM,CAAC1B,IAAI,CAAC2B,OAAO,CAAC,CAACP,MAAM,CAAC,CAAC,EAAE,CAACT,MAAM,EAAE;MAAEiB,KAAK,EAAC,QAAQ;MAAEC,KAAK,EAAC;IAAG,CAAC,CAAC;EACnF,CAAC,EAAE,CAACvB,aAAa,EAAEC,MAAM,EAAEI,MAAM,CAAC,CAAC;;EAEnC;EACA,SAASmB,UAAUA,CAACP,CAAC,EAACC,CAAC,EAACO,CAAC,EAACC,CAAC,EAAE;IAC3B,IAAI,CAACd,SAAS,EAAE,OAAO,KAAK;IAC5B,MAAMe,IAAI,GAAGjC,IAAI,CAAC2B,OAAO,CAAC,CAAC,CACzB,CAACJ,CAAC,EAACC,CAAC,CAAC,EAAC,CAACD,CAAC,GAACQ,CAAC,EAACP,CAAC,CAAC,EAAC,CAACD,CAAC,GAACQ,CAAC,EAACP,CAAC,GAACQ,CAAC,CAAC,EAAC,CAACT,CAAC,EAACC,CAAC,GAACQ,CAAC,CAAC,EAAC,CAACT,CAAC,EAACC,CAAC,CAAC,CACtC,CAAC,CAAC;IACH,OAAOxB,IAAI,CAACkC,eAAe,CAAChB,SAAS,EAAEe,IAAI,CAAC;EAC9C;;EAEA;EACA,SAASE,SAASA,CAACC,GAAG,EAACb,CAAC,EAACC,CAAC,EAACO,CAAC,EAACC,CAAC,EAAE;IAC9BxB,UAAU,CAAC6B,OAAO,CAAC,CAACC,CAAC,EAACC,CAAC,KAAG;MACxB,IAAIA,CAAC,KAAGH,GAAG,EAAE;MACb,CAAC,CAACE,CAAC,CAACf,CAAC,CAAC,EAAC,CAACe,CAAC,CAACf,CAAC,GAACe,CAAC,CAACE,KAAK,CAAC,CAAC,CAACH,OAAO,CAAC,CAAC,CAACI,EAAE,CAAC,KAAG;QACpC,IAAIC,IAAI,CAACC,GAAG,CAACpB,CAAC,GAACkB,EAAE,CAAC,GAACxB,OAAO,EAAEM,CAAC,GAACkB,EAAE;QAChC,IAAIC,IAAI,CAACC,GAAG,CAACpB,CAAC,GAACQ,CAAC,GAACU,EAAE,CAAC,GAACxB,OAAO,EAAEM,CAAC,GAACkB,EAAE,GAACV,CAAC;MACtC,CAAC,CAAC;MACF,CAAC,CAACO,CAAC,CAACd,CAAC,CAAC,EAAC,CAACc,CAAC,CAACd,CAAC,GAACc,CAAC,CAACM,MAAM,CAAC,CAAC,CAACP,OAAO,CAAC,CAAC,CAACQ,EAAE,CAAC,KAAG;QACrC,IAAIH,IAAI,CAACC,GAAG,CAACnB,CAAC,GAACqB,EAAE,CAAC,GAAC5B,OAAO,EAAEO,CAAC,GAACqB,EAAE;QAChC,IAAIH,IAAI,CAACC,GAAG,CAACnB,CAAC,GAACQ,CAAC,GAACa,EAAE,CAAC,GAAC5B,OAAO,EAAEO,CAAC,GAACqB,EAAE,GAACb,CAAC;MACtC,CAAC,CAAC;IACJ,CAAC,CAAC;IACF,OAAO;MAAET,CAAC;MAACC;IAAE,CAAC;EAChB;;EAEA;EACA3B,SAAS,CAAC,MAAI;IACZ,MAAMiD,MAAM,GAAGjC,SAAS,CAACkC,OAAO;IAChC,SAASC,MAAMA,CAACC,CAAC,EAAE;MACjB,MAAMC,CAAC,GAACJ,MAAM,CAACK,qBAAqB,CAAC,CAAC;MACtC,OAAO;QACLC,EAAE,EAAC,CAACH,CAAC,CAACI,OAAO,GAACH,CAAC,CAACI,IAAI,IAAEtC,KAAK;QAC3BuC,EAAE,EAAC,CAACN,CAAC,CAACO,OAAO,GAACN,CAAC,CAACO,GAAG,IAAEzC;MACvB,CAAC;IACH;IACA,SAAS0C,IAAIA,CAACT,CAAC,EAAE;MACf,MAAM;QAACG,EAAE;QAACG;MAAE,CAAC,GAACP,MAAM,CAACC,CAAC,CAAC;MACvB,KAAI,IAAIU,CAAC,GAACnD,UAAU,CAACW,MAAM,GAAC,CAAC,EAACwC,CAAC,IAAE,CAAC,EAACA,CAAC,EAAE,EAAC;QACrC,MAAMrB,CAAC,GAAC9B,UAAU,CAACmD,CAAC,CAAC;QACrB,IAAGP,EAAE,IAAEd,CAAC,CAACf,CAAC,IAAE6B,EAAE,IAAEd,CAAC,CAACf,CAAC,GAACe,CAAC,CAACE,KAAK,IAAEe,EAAE,IAAEjB,CAAC,CAACd,CAAC,IAAE+B,EAAE,IAAEjB,CAAC,CAACd,CAAC,GAACc,CAAC,CAACM,MAAM,EAAC;UACrD,IAAGK,CAAC,CAACW,MAAM,KAAG,CAAC,EAAC;YAAElD,UAAU,CAACiD,CAAC,CAAC;YAAE;UAAQ;UACzC5C,WAAW,CAAC;YAAEqB,GAAG,EAACuB,CAAC;YAAEE,OAAO,EAACT,EAAE,GAACd,CAAC,CAACf,CAAC;YAAEuC,OAAO,EAACP,EAAE,GAACjB,CAAC,CAACd;UAAE,CAAC,CAAC;UACtD;QACF;MACF;IACF;IACA,SAASuC,IAAIA,CAACd,CAAC,EAAE;MACf,IAAG,CAACnC,QAAQ,EAAE;MACd,MAAM;QAACsC,EAAE;QAACG;MAAE,CAAC,GAACP,MAAM,CAACC,CAAC,CAAC;MACvB,MAAM;QAACb,GAAG;QAACyB,OAAO;QAACC;MAAO,CAAC,GAAChD,QAAQ;MACpC,MAAMwB,CAAC,GAAC9B,UAAU,CAAC4B,GAAG,CAAC;MACvB,IAAI4B,EAAE,GAACZ,EAAE,GAACS,OAAO;QAAEI,EAAE,GAACV,EAAE,GAACO,OAAO;MAChC,CAAC;QAACvC,CAAC,EAACyC,EAAE;QAACxC,CAAC,EAACyC;MAAE,CAAC,GAAC9B,SAAS,CAACC,GAAG,EAAC4B,EAAE,EAACC,EAAE,EAAC3B,CAAC,CAACE,KAAK,EAACF,CAAC,CAACM,MAAM,CAAC;MAClD,IAAGd,UAAU,CAACkC,EAAE,EAACC,EAAE,EAAC3B,CAAC,CAACE,KAAK,EAACF,CAAC,CAACM,MAAM,CAAC,EAAC;QACpC,MAAMsB,EAAE,GAAC,CAAC,GAAG1D,UAAU,CAAC;QACxB0D,EAAE,CAAC9B,GAAG,CAAC,GAAC;UAAC,GAAGE,CAAC;UAACf,CAAC,EAACyC,EAAE;UAACxC,CAAC,EAACyC;QAAE,CAAC;QACxBxD,aAAa,CAACyD,EAAE,CAAC;MACnB;IACF;IACA,SAASC,EAAEA,CAAA,EAAE;MAAE,IAAGrD,QAAQ,EAAEC,WAAW,CAAC,IAAI,CAAC;IAAE;IAC/C+B,MAAM,CAACsB,gBAAgB,CAAC,WAAW,EAACV,IAAI,CAAC;IACzCW,MAAM,CAACD,gBAAgB,CAAC,WAAW,EAACL,IAAI,CAAC;IACzCM,MAAM,CAACD,gBAAgB,CAAC,SAAS,EAACD,EAAE,CAAC;IACrC,OAAO,MAAI;MACTrB,MAAM,CAACwB,mBAAmB,CAAC,WAAW,EAACZ,IAAI,CAAC;MAC5CW,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAACP,IAAI,CAAC;MAC5CM,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAACH,EAAE,CAAC;IAC1C,CAAC;EACH,CAAC,EAAC,CAACrD,QAAQ,EAACN,UAAU,EAACU,SAAS,CAAC,CAAC;;EAElC;EACArB,SAAS,CAAC,MAAI;IACZ,MAAM0E,CAAC,GAAC1D,SAAS,CAACkC,OAAO;MAAEyB,GAAG,GAACD,CAAC,CAACE,UAAU,CAAC,IAAI,CAAC;IACjDF,CAAC,CAAC/B,KAAK,GAACpC,KAAK,GAACY,KAAK;IAAEuD,CAAC,CAAC3B,MAAM,GAACvC,KAAK,GAACW,KAAK;IACzCwD,GAAG,CAACE,SAAS,CAAC,CAAC,EAAC,CAAC,EAACH,CAAC,CAAC/B,KAAK,EAAC+B,CAAC,CAAC3B,MAAM,CAAC;;IAEnC;IACA,IAAGtC,aAAa,CAACa,MAAM,EAAC;MACtBqD,GAAG,CAACG,WAAW,GAAC,SAAS;MAAEH,GAAG,CAACI,SAAS,GAAC,CAAC;MAC1CJ,GAAG,CAACK,SAAS,CAAC,CAAC;MACfvE,aAAa,CAAC+B,OAAO,CAAC,CAACf,CAAC,EAACqC,CAAC,KAAG;QAC3B,MAAMmB,CAAC,GAACxD,CAAC,CAACC,CAAC,GAACP,KAAK;UAAE+D,CAAC,GAACzD,CAAC,CAACE,CAAC,GAACR,KAAK;QAC9B2C,CAAC,KAAG,CAAC,GAACa,GAAG,CAACQ,MAAM,CAACF,CAAC,EAACC,CAAC,CAAC,GAACP,GAAG,CAACS,MAAM,CAACH,CAAC,EAACC,CAAC,CAAC;MACvC,CAAC,CAAC;MACF,IAAGxE,MAAM,EAACiE,GAAG,CAACU,SAAS,CAAC,CAAC;MACzBV,GAAG,CAACW,MAAM,CAAC,CAAC;MACZX,GAAG,CAACY,SAAS,GAAC,SAAS;MACvB9E,aAAa,CAAC+B,OAAO,CAACf,CAAC,IAAE;QACvBkD,GAAG,CAACK,SAAS,CAAC,CAAC;QACfL,GAAG,CAACa,GAAG,CAAC/D,CAAC,CAACC,CAAC,GAACP,KAAK,EAACM,CAAC,CAACE,CAAC,GAACR,KAAK,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,GAAC0B,IAAI,CAAC4C,EAAE,CAAC;QAC1Cd,GAAG,CAACe,IAAI,CAAC,CAAC;MACZ,CAAC,CAAC;IACJ;;IAEA;IACA/E,UAAU,CAAC6B,OAAO,CAACC,CAAC,IAAE;MACpB,MAAMf,CAAC,GAACe,CAAC,CAACf,CAAC,GAACP,KAAK;QAACQ,CAAC,GAACc,CAAC,CAACd,CAAC,GAACR,KAAK;MAC7B,MAAMe,CAAC,GAACO,CAAC,CAACE,KAAK,GAACxB,KAAK;QAACgB,CAAC,GAACM,CAAC,CAACM,MAAM,GAAC5B,KAAK;MACtCwD,GAAG,CAACY,SAAS,GAAC,MAAM;MACpBZ,GAAG,CAACG,WAAW,GAAC,MAAM;MACtBH,GAAG,CAACI,SAAS,GAAC,CAAC;MACfJ,GAAG,CAACgB,QAAQ,CAACjE,CAAC,EAACC,CAAC,EAACO,CAAC,EAACC,CAAC,CAAC;MACrBwC,GAAG,CAACiB,UAAU,CAAClE,CAAC,EAACC,CAAC,EAACO,CAAC,EAACC,CAAC,CAAC;IACzB,CAAC,CAAC;IAEF,IAAG,CAACzB,MAAM,IAAEC,UAAU,CAACW,MAAM,KAAG,CAAC,EAAE;;IAEnC;IACA,IAAIuE,SAAS,GAAC,IAAI;IAClBlF,UAAU,CAAC6B,OAAO,CAACC,CAAC,IAAE;MACpB,MAAMqD,IAAI,GAAC3F,IAAI,CAAC2B,OAAO,CAAC,CAAC,CACvB,CAACW,CAAC,CAACf,CAAC,EAACe,CAAC,CAACd,CAAC,CAAC,EACT,CAACc,CAAC,CAACf,CAAC,GAACe,CAAC,CAACE,KAAK,EAACF,CAAC,CAACd,CAAC,CAAC,EACjB,CAACc,CAAC,CAACf,CAAC,GAACe,CAAC,CAACE,KAAK,EAACF,CAAC,CAACd,CAAC,GAACc,CAAC,CAACM,MAAM,CAAC,EAC1B,CAACN,CAAC,CAACf,CAAC,EAACe,CAAC,CAACd,CAAC,GAACc,CAAC,CAACM,MAAM,CAAC,EAClB,CAACN,CAAC,CAACf,CAAC,EAACe,CAAC,CAACd,CAAC,CAAC,CACV,CAAC,CAAC;MACHkE,SAAS,GAACA,SAAS,GAAC1F,IAAI,CAAC4F,KAAK,CAACF,SAAS,EAACC,IAAI,CAAC,GAACA,IAAI;IACrD,CAAC,CAAC;IACFD,SAAS,GAAG1F,IAAI,CAAC0B,MAAM,CAACgE,SAAS,EAAC,QAAQ,EAAC;MAAC9D,KAAK,EAAC;IAAQ,CAAC,CAAC;IAC5D8D,SAAS,GAAG1F,IAAI,CAAC0B,MAAM,CAACgE,SAAS,EAAC,CAAC,QAAQ,EAAC;MAAC9D,KAAK,EAAC;IAAQ,CAAC,CAAC;IAC7D,IAAIiE,MAAM,GAAG7F,IAAI,CAAC0B,MAAM,CAACgE,SAAS,EAAC/E,MAAM,EAAC;MAACiB,KAAK,EAAC,QAAQ;MAACC,KAAK,EAAC;IAAE,CAAC,CAAC;IACpE;IACA,MAAMiE,IAAI,GAAG9F,IAAI,CAAC2B,OAAO,CAAC,CAAC,CACzB,GAAGrB,aAAa,CAACe,GAAG,CAACC,CAAC,IAAE,CAACA,CAAC,CAACC,CAAC,EAACD,CAAC,CAACE,CAAC,CAAC,CAAC,EAClC,CAAClB,aAAa,CAAC,CAAC,CAAC,CAACiB,CAAC,EAACjB,aAAa,CAAC,CAAC,CAAC,CAACkB,CAAC,CAAC,CACxC,CAAC,CAAC;IACH,MAAMuE,SAAS,GAAG/F,IAAI,CAAC0B,MAAM,CAACoE,IAAI,EAAC,CAACnF,MAAM,EAAC;MAACiB,KAAK,EAAC,QAAQ;MAACC,KAAK,EAAC;IAAE,CAAC,CAAC;IACrE,MAAMmE,OAAO,GAAGhG,IAAI,CAACiG,SAAS,CAACJ,MAAM,EAACE,SAAS,CAAC;IAChD,IAAGC,OAAO,EAAEH,MAAM,GAAGG,OAAO;IAC5B,MAAME,IAAI,GAAGL,MAAM,CAACM,QAAQ;IAC5B,MAAMC,KAAK,GAAGF,IAAI,CAACG,IAAI,KAAG,SAAS,GAC/B,CAACH,IAAI,CAACI,WAAW,CAAC,CAAC,CAAC,CAAC,GACrBJ,IAAI,CAACI,WAAW,CAACjF,GAAG,CAACkD,CAAC,IAAEA,CAAC,CAAC,CAAC,CAAC,CAAC;IACjCC,GAAG,CAACG,WAAW,GAAC,KAAK;IAAEH,GAAG,CAAC+B,WAAW,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;IAAE/B,GAAG,CAACI,SAAS,GAAC,CAAC;IAC9DwB,KAAK,CAAC/D,OAAO,CAACmE,IAAI,IAAE;MAClBhC,GAAG,CAACK,SAAS,CAAC,CAAC;MACf2B,IAAI,CAACnE,OAAO,CAAC,CAAC,CAACoE,EAAE,EAACC,EAAE,CAAC,EAAC/C,CAAC,KAAG;QACxB,MAAMmB,CAAC,GAAC2B,EAAE,GAACzF,KAAK;UAAE+D,CAAC,GAAC2B,EAAE,GAAC1F,KAAK;QAC5B2C,CAAC,KAAG,CAAC,GAACa,GAAG,CAACQ,MAAM,CAACF,CAAC,EAACC,CAAC,CAAC,GAACP,GAAG,CAACS,MAAM,CAACH,CAAC,EAACC,CAAC,CAAC;MACvC,CAAC,CAAC;MACFP,GAAG,CAACW,MAAM,CAAC,CAAC;IACd,CAAC,CAAC;IACFX,GAAG,CAAC+B,WAAW,CAAC,EAAE,CAAC;;IAEnB;IACA/B,GAAG,CAACG,WAAW,GAAC,OAAO;IAAEH,GAAG,CAAC+B,WAAW,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;IAAE/B,GAAG,CAACI,SAAS,GAAC,CAAC;IAChE,IAAI+B,KAAK,GAAC,CAAC;IACXrG,aAAa,CAAC+B,OAAO,CAAC,CAACf,CAAC,EAACqC,CAAC,KAAG;MAC3B,MAAMiD,CAAC,GAACtG,aAAa,CAAC,CAACqD,CAAC,GAAC,CAAC,IAAErD,aAAa,CAACa,MAAM,CAAC;MACjDwF,KAAK,IAAIrF,CAAC,CAACC,CAAC,GAACqF,CAAC,CAACpF,CAAC,GAAGoF,CAAC,CAACrF,CAAC,GAACD,CAAC,CAACE,CAAC;IAC5B,CAAC,CAAC;IACF,MAAMqF,GAAG,GAAGF,KAAK,GAAG,CAAC;IACrBrG,aAAa,CAAC+B,OAAO,CAAC,CAACf,CAAC,EAACqC,CAAC,KAAG;MAC3B,MAAMiD,CAAC,GAAGtG,aAAa,CAAC,CAACqD,CAAC,GAAC,CAAC,IAAErD,aAAa,CAACa,MAAM,CAAC;MACnD,MAAM2F,EAAE,GAAGF,CAAC,CAACrF,CAAC,GAACD,CAAC,CAACC,CAAC;QAAEwF,EAAE,GAAGH,CAAC,CAACpF,CAAC,GAACF,CAAC,CAACE,CAAC;QAAEwF,GAAG,GAAGtE,IAAI,CAACuE,KAAK,CAACH,EAAE,EAACC,EAAE,CAAC;MACzD,MAAM/C,EAAE,GAAG6C,GAAG,GAAG,CAACE,EAAE,GAACC,GAAG,GAAGD,EAAE,GAACC,GAAG;MACjC,MAAM/C,EAAE,GAAG4C,GAAG,GAAIC,EAAE,GAACE,GAAG,GAAG,CAACF,EAAE,GAACE,GAAG;MAClC,MAAMP,EAAE,GAAG,CAACnF,CAAC,CAACC,CAAC,GAAGyC,EAAE,GAACrD,MAAM,IAAEK,KAAK;MAClC,MAAM0F,EAAE,GAAG,CAACpF,CAAC,CAACE,CAAC,GAAGyC,EAAE,GAACtD,MAAM,IAAEK,KAAK;MAClC,MAAMkG,EAAE,GAAG,CAACN,CAAC,CAACrF,CAAC,GAAGyC,EAAE,GAACrD,MAAM,IAAEK,KAAK;MAClC,MAAMmG,EAAE,GAAG,CAACP,CAAC,CAACpF,CAAC,GAAGyC,EAAE,GAACtD,MAAM,IAAEK,KAAK;MAClCwD,GAAG,CAACK,SAAS,CAAC,CAAC;MACfL,GAAG,CAACQ,MAAM,CAACyB,EAAE,EAACC,EAAE,CAAC;MACjBlC,GAAG,CAACS,MAAM,CAACiC,EAAE,EAACC,EAAE,CAAC;MACjB3C,GAAG,CAACW,MAAM,CAAC,CAAC;IACd,CAAC,CAAC;IACFX,GAAG,CAAC+B,WAAW,CAAC,EAAE,CAAC;EAErB,CAAC,EAAC,CAACnG,KAAK,EAACC,KAAK,EAACC,aAAa,EAACC,MAAM,EAACC,UAAU,EAACG,MAAM,CAAC,CAAC;EAEvD,oBACET,OAAA;IACEkH,GAAG,EAAEvG,SAAU;IACfwG,KAAK,EAAE;MACLC,MAAM,EAAC,gBAAgB;MACvBC,MAAM,EAACzG,QAAQ,GAAC,UAAU,GAAC,MAAM;MACjC0G,SAAS,EAAC;IACZ;EAAE;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEN;AAAChH,EAAA,CA5MuBT,YAAY;AAAA0H,EAAA,GAAZ1H,YAAY;AAAA,IAAA0H,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}